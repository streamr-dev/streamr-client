!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("streamr-client",[],t):"object"==typeof exports?exports["streamr-client"]=t():e.StreamrClient=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,n){"use strict";function s(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var i=new r(n,s||e,o),c=a?a+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],i]:e._events[c].push(i):(e._events[c]=i,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function c(){this._events=new s,this._eventsCount=0}var u=Object.prototype.hasOwnProperty,a="~";Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(a=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)u.call(e,t)&&n.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=a?a+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,r=n.length,o=new Array(r);s<r;s++)o[s]=n[s].fn;return o},c.prototype.listenerCount=function(e){var t=a?a+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,s,r,o){var i=a?a+e:e;if(!this._events[i])return!1;var c,u,f=this._events[i],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,n),!0;case 4:return f.fn.call(f.context,t,n,s),!0;case 5:return f.fn.call(f.context,t,n,s,r),!0;case 6:return f.fn.call(f.context,t,n,s,r,o),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];f.fn.apply(f.context,c)}else{var d,h=f.length;for(u=0;u<h;u++)switch(f[u].once&&this.removeListener(e,f[u].fn,void 0,!0),l){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,t);break;case 3:f[u].fn.call(f[u].context,t,n);break;case 4:f[u].fn.call(f[u].context,t,n,s);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];f[u].fn.apply(f[u].context,c)}}return!0},c.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,s){var r=a?a+e:e;if(!this._events[r])return this;if(!t)return i(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||s&&!o.once||n&&o.context!==n||i(this,r);else{for(var c=0,u=[],f=o.length;c<f;c++)(o[c].fn!==t||s&&!o[c].once||n&&o[c].context!==n)&&u.push(o[c]);u.length?this._events[r]=1===u.length?u[0]:u:i(this,r)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=a?a+e:e,this._events[t]&&i(this,t)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=a,c.EventEmitter=c,e.exports=c},function(e,t,n){(function(s){function r(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))}),e.splice(o,0,s)}}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function c(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function u(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==s&&"env"in s&&(e=s.env.DEBUG),e}t=e.exports=n(7),t.log=i,t.formatArgs=o,t.save=c,t.load=u,t.useColors=r,t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(u())}).call(t,n(6))},function(e,t,n){"use strict";function s(e){var t=JSON.parse(e),n=t[0];if(0!==n)throw"Unknown message version: "+n;return{type:a[t[1]],subId:t[2],msg:t[3]}}function r(e,t){if("b"===e||"u"===e){if(void 0===u[t[0]])throw"Unsupported version: "+t[0];for(var n={},s=u[t[0]],r=0;r<t.length;r++){if("content"===s[r]){if(n.contentType!==c)throw"Unknown content type: "+n.contentType;t[r]=JSON.parse(t[r])}n[s[r]]=t[r]}return n}return t}function o(e,t){var n={stream:e};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}function i(e){return!!e[f]}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeBrowserWrapper=s,t.decodeMessage=r,t.createSubscribeRequest=o,t.isByeMessage=i;var c=27,u={28:["version","streamId","streamPartition","timestamp","ttl","offset","previousOffset","contentType","content"]},a=["b","u","subscribed","unsubscribed","resending","resent","no_resend"],f="_bye"},function(e,t,n){"use strict";var s="undefined"!=typeof window?window.WebSocket:n(3);e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),r=function(e){return e&&e.__esModule?e:{default:e}}(s);t.default=r.default,e.exports=t.default},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a=n(0),f=s(a),l=n(1),d=s(l),h=n(9),b=s(h),p=n(10),m=s(p),y=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.options={url:"wss://www.streamr.com/api/v1/ws",autoConnect:!0,autoDisconnect:!0,authKey:null},n.subsByStream={},n.subById={},n.connection=null,n.connected=!1,Object.assign(n.options,e||{}),n}return i(t,e),u(t,[{key:"_addSubscription",value:function(e){this.subById[e.id]=e,this.subsByStream[e.streamId]?this.subsByStream[e.streamId].push(e):this.subsByStream[e.streamId]=[e]}},{key:"_removeSubscription",value:function(e){delete this.subById[e.id],this.subsByStream[e.streamId]&&(this.subsByStream[e.streamId]=this.subsByStream[e.streamId].filter(function(t){return t!==e}),0===this.subsByStream[e.streamId].length&&delete this.subsByStream[e.streamId])}},{key:"getSubscriptions",value:function(e){return this.subsByStream[e]||[]}},{key:"subscribe",value:function(e,t,n){var s=this;if(!e)throw"subscribe: Invalid arguments: subscription options is required!";if(!t)throw"subscribe: Invalid arguments: callback is required!";if("string"==typeof e)e={stream:e};else if("object"!==(void 0===e?"undefined":c(e)))throw"subscribe: options must be an object";if(Object.assign(e,n),!e.stream)throw"subscribe: Invalid arguments: options.stream is not given";var r=new b.default(e.stream,e.partition||0,e.authKey||this.options.authKey,t,e);return r.on("gap",function(e,t){s._requestResend(r,{resend_from:e,resend_to:t})}),r.on("done",function(){(0,d.default)("done event for sub %d",r.id),s.unsubscribe(r)}),this._addSubscription(r),this.connected?this._resendAndSubscribe(r):this.options.autoConnect&&this.connect(),r}},{key:"unsubscribe",value:function(e){if(!e||!e.streamId)throw"unsubscribe: please give a Subscription object as an argument!";void 0!==this.subsByStream[e.streamId]&&1===this.subsByStream[e.streamId].length&&this.connected&&!this.disconnecting&&e.isSubscribed()&&!e.unsubscribing?(e.unsubscribing=!0,this._requestUnsubscribe(e.streamId)):e.unsubscribing||(this._removeSubscription(e),e.emit("unsubscribed"),this._checkAutoDisconnect())}},{key:"unsubscribeAll",value:function(e){var t=this;if(!e)throw"unsubscribeAll: a stream id is required!";if("string"!=typeof e)throw"unsubscribe: stream id must be a string!";if(this.subsByStream[e]){this.subsByStream[e].slice().forEach(function(e){t.unsubscribe(e)})}}},{key:"isConnected",value:function(){return this.connected}},{key:"reconnect",value:function(){return this.connect(!0)}},{key:"connect",value:function(){var e=this;return this.connected?void(0,d.default)("connect() called while already connected, doing nothing..."):this.connecting?void(0,d.default)("connect() called while connecting, doing nothing..."):((0,d.default)("Connecting to %s",this.options.url),this.connecting=!0,this.disconnecting=!1,this.connection=new m.default(this.options),this.connection.on("b",function(t){var n=t.streamId,s=e.subsByStream[n];if(s)for(var r=0;r<s.length;r++)s[r].handleMessage(t,!1);else(0,d.default)("WARN: message received for stream with no subscriptions: %s",n)}),this.connection.on("u",function(t,n){void 0!==n&&void 0!==e.subById[n]?e.subById[n].handleMessage(t,!0):(0,d.default)("WARN: subscription not found for stream: %s, sub: %s",t.streamId,n)}),this.connection.on("subscribed",function(t){if(t.error)e.handleError("Error subscribing to "+t.stream+": "+t.error);else{var n=e.subsByStream[t.stream];delete n._subscribing,(0,d.default)("Client subscribed: %o",t),n.filter(function(e){return!e.resending}).forEach(function(e){e.emit("subscribed")})}}),this.connection.on("unsubscribed",function(t){if((0,d.default)("Client unsubscribed: %o",t),e.subsByStream[t.stream]){e.subsByStream[t.stream].slice().forEach(function(t){e._removeSubscription(t),t.emit("unsubscribed")})}e._checkAutoDisconnect()}),this.connection.on("resending",function(t){e.subById[t.sub]?e.subById[t.sub].emit("resending",t):(0,d.default)("resent: Subscription %d is gone already",t.sub)}),this.connection.on("no_resend",function(t){e.subById[t.sub]?e.subById[t.sub].emit("no_resend",t):(0,d.default)("resent: Subscription %d is gone already",t.sub)}),this.connection.on("resent",function(t){e.subById[t.sub]?e.subById[t.sub].emit("resent",t):(0,d.default)("resent: Subscription %d is gone already",t.sub)}),this.connection.on("connected",function(){(0,d.default)("Connected!"),e.connected=!0,e.connecting=!1,e.disconnecting=!1,e.emit("connected"),Object.keys(e.subsByStream).forEach(function(t){e.subsByStream[t].forEach(function(t){t.isSubscribed()||e._resendAndSubscribe(t)})})}),this.connection.on("disconnected",function(){(0,d.default)("Disconnected."),e.connected=!1,e.connecting=!1,e.disconnecting=!1,e.emit("disconnected"),Object.keys(e.subsByStream).forEach(function(t){var n=e.subsByStream[t];delete n._subscribing,n.forEach(function(e){e.emit("disconnected")})})}),this.connection.connect(),this.subsByStream)}},{key:"pause",value:function(){this.connection.disconnect()}},{key:"disconnect",value:function(){var e=this;this.connecting=!1,this.disconnecting=!0,Object.keys(this.subsByStream).forEach(function(t){e.unsubscribeAll(t)}),this.connection.disconnect()}},{key:"_checkAutoDisconnect",value:function(){this.options.autoDisconnect&&0===Object.keys(this.subsByStream).length&&((0,d.default)("Disconnecting due to no longer being subscribed to any streams"),this.disconnect())}},{key:"_resendAndSubscribe",value:function(e){var t=this;e.subscribing||e.resending||(e.subscribing=!0,this._requestSubscribe(e),e.once("subscribed",function(){e.hasResendOptions()&&t._requestResend(e)}))}},{key:"_requestSubscribe",value:function(e){var t=this.subsByStream[e.streamId],n=t.filter(function(e){return e.isSubscribed()});if(t._subscribing||0!==n.length)n.length>0&&((0,d.default)("_requestSubscribe: another subscription for same stream: %s, insta-subscribing",e.streamId),setTimeout(function(){e.emit("subscribed")},0));else{var s=Object.assign({},e.options,{type:"subscribe",stream:e.streamId,authKey:e.authKey});(0,d.default)("_requestSubscribe: subscribing client: %o",s),t._subscribing=!0,this.connection.send(s)}}},{key:"_requestUnsubscribe",value:function(e){(0,d.default)("Client unsubscribing stream %o",e),this.connection.send({type:"unsubscribe",stream:e})}},{key:"_requestResend",value:function(e,t){var n=Object.assign({},e.getEffectiveResendOptions());t&&Object.keys(n).forEach(function(e){e.match(/resend_.*/)&&delete n[e]}),e.resending=!0;var s=Object.assign({},n,t,{type:"resend",stream:e.streamId,partition:e.streamPartition,authKey:e.authKey,sub:e.id});(0,d.default)("_requestResend: %o",s),this.connection.send(s)}},{key:"handleError",value:function(e){(0,d.default)(e),this.emit("error",e)}}]),t}(f.default);t.default=y,e.exports=t.default},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function r(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function o(e){if(l===clearTimeout)return clearTimeout(e);if((l===s||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function i(){p&&h&&(p=!1,h.length?b=h.concat(b):m=-1,b.length&&c())}function c(){if(!p){var e=r(i);p=!0;for(var t=b.length;t;){for(h=b,b=[];++m<t;)h&&h[m].run();m=-1,t=b.length}h=null,p=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function a(){}var f,l,d=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{l="function"==typeof clearTimeout?clearTimeout:s}catch(e){l=s}}();var h,b=[],p=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];b.push(new u(e,t)),1!==b.length||p||r(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=a,d.addListener=a,d.once=a,d.off=a,d.removeListener=a,d.removeAllListeners=a,d.emit=a,d.prependListener=a,d.prependOnceListener=a,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,n){function s(e){var n,s=0;for(n in e)s=(s<<5)-s+e.charCodeAt(n),s|=0;return t.colors[Math.abs(s)%t.colors.length]}function r(e){function n(){if(n.enabled){var e=n,s=+new Date,o=s-(r||s);e.diff=o,e.prev=r,e.curr=s,r=s;for(var i=new Array(arguments.length),c=0;c<i.length;c++)i[c]=arguments[c];i[0]=t.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var u=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(n,s){if("%%"===n)return n;u++;var r=t.formatters[s];if("function"==typeof r){var o=i[u];n=r.call(e,o),i.splice(u,1),u--}return n}),t.formatArgs.call(e,i);(n.log||t.log||console.log.bind(console)).apply(e,i)}}var r;return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=s(e),n.destroy=o,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function i(e){t.save(e),t.names=[],t.skips=[];var n,s=("string"==typeof e?e:"").split(/[\s,]+/),r=s.length;for(n=0;n<r;n++)s[n]&&(e=s[n].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}}function c(){t.enable("")}function u(e){if("*"===e[e.length-1])return!0;var n,s;for(n=0,s=t.skips.length;n<s;n++)if(t.skips[n].test(e))return!1;for(n=0,s=t.names.length;n<s;n++)if(t.names[n].test(e))return!0;return!1}function a(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=r.debug=r.default=r,t.coerce=a,t.disable=c,t.enable=i,t.enabled=u,t.humanize=n(8),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function n(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*f;case"days":case"day":case"d":return n*a;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*c;case"seconds":case"second":case"secs":case"sec":case"s":return n*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function s(e){return e>=a?Math.round(e/a)+"d":e>=u?Math.round(e/u)+"h":e>=c?Math.round(e/c)+"m":e>=i?Math.round(e/i)+"s":e+"ms"}function r(e){return o(e,a,"day")||o(e,u,"hour")||o(e,c,"minute")||o(e,i,"second")||e+" ms"}function o(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var i=1e3,c=60*i,u=60*c,a=24*u,f=365.25*a;e.exports=function(e,t){t=t||{};var o=typeof e;if("string"===o&&e.length>0)return n(e);if("number"===o&&!1===isNaN(e))return t.long?r(e):s(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(){return(b++).toString()}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a=n(0),f=s(a),l=n(1),d=s(l),h=n(2),b=0,p=function(e){function t(e,n,s,i,u){r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e)throw"No stream id given!";if(!i)throw"No callback given!";a.id=c(),a.streamId=e,a.streamPartition=n,a.authKey=s,a.callback=i,a.options=u||{},a.queue=[],a.subscribing=!1,a.subscribed=!1,a.lastReceivedOffset=null;var f=0;if(a.options.resend_all&&f++,null!=a.options.resend_from&&f++,null!=a.options.resend_last&&f++,null!=a.options.resend_from_time&&f++,f>1)throw"Multiple resend options active! Please use only one: "+JSON.stringify(u);if(null!=a.options.resend_from_time&&"number"!=typeof a.options.resend_from_time){if("function"!=typeof a.options.resend_from_time.getTime)throw"resend_from_time option must be a Date object or a number representing time!";a.options.resend_from_time=a.options.resend_from_time.getTime()}return a.on("subscribed",function(){(0,d.default)("Sub %s subscribed to stream: %s",a.id,a.streamId),a.subscribed=!0,a.subscribing=!1}),a.on("unsubscribed",function(){(0,d.default)("Sub %s unsubscribed: %s",a.id,a.streamId),a.subscribed=!1,a.subscribing=!1,a.unsubscribing=!1,a.resending=!1}),a.on("resending",function(e){(0,d.default)("Sub %s resending: %o",a.id,e)}),a.on("no_resend",function(e){(0,d.default)("Sub %s no_resend: %o",a.id,e),a.resending=!1,a.checkQueue()}),a.on("resent",function(e){(0,d.default)("Sub %s resent: %o",a.id,e),a.resending=!1,a.checkQueue()}),a.on("connected",function(){}),a.on("disconnected",function(){a.subscribed=!1,a.subscribing=!1,a.resending=!1}),a}return i(t,e),u(t,[{key:"handleMessage",value:function(e,t){var n=e.content,s=e.offset,r=e.previousOffset;if(null==r&&(0,d.default)("handleMessage: prevOffset is null, gap detection is impossible! message: %o",e),this.resending&&!t)this.queue.push(e);else if(null!=r&&null!=this.lastReceivedOffset&&r>this.lastReceivedOffset&&!this.resending){this.queue.push(e);var o=this.lastReceivedOffset+1,i=r;(0,d.default)("Gap detected, requesting resend for stream %s from %d to %d",this.streamId,o,i),this.emit("gap",o,i)}else null!=this.lastReceivedOffset&&s<=this.lastReceivedOffset?(0,d.default)("Sub %s already received message: %d, lastReceivedOffset: %d. Ignoring message.",this.id,s,this.lastReceivedOffset):(this.lastReceivedOffset=s,this.callback(n,e),(0,h.isByeMessage)(n)&&this.emit("done"))}},{key:"checkQueue",value:function(){if(this.queue.length){(0,d.default)("Attempting to process %d queued messages for stream %s",this.queue.length,this.streamId);var e=void 0,t=this.queue.length,n=this.queue;for(this.queue=[],e=0;e<t;e++){var s=n[e];this.handleMessage(s,!1)}}}},{key:"hasResendOptions",value:function(){return!0===this.options.resend_all||this.options.resend_from>=0||this.options.resend_from_time>=0||this.options.resend_last>0}},{key:"getEffectiveResendOptions",value:function(){return this.hasReceivedMessages()&&this.hasResendOptions()?this.options.resend_all||this.options.resend_from||this.options.resend_from_time?{resend_from:this.lastReceivedOffset+1}:this.options.resend_last?this.options:void 0:this.options}},{key:"hasReceivedMessages",value:function(){return null!=this.lastReceivedOffset}},{key:"isSubscribed",value:function(){return this.subscribed}}]),t}(f.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=n(0),a=s(u),f=n(1),l=s(f),d=n(3),h=s(d),b=n(2),p=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e.url)throw"URL is not defined!";return n.options=e,n.connected=!1,n.connecting=!1,n.disconnecting=!1,e.autoConnect&&n.connect(),n}return i(t,e),c(t,[{key:"connect",value:function(){var e=this;this.connected||this.connecting||(this.connecting=!0,this.socket=new h.default(this.options.url),this.socket.binaryType="arraybuffer",this.emit("connecting"),this.socket.onopen=function(){(0,l.default)("Connected to ",e.options.url),e.connected=!0,e.connecting=!1,e.emit("connected")},this.socket.onclose=function(){e.disconnecting?e.disconnecting=!1:((0,l.default)("Connection lost. Attempting to reconnect"),setTimeout(function(){e.connect()},2e3)),e.connected=!1,e.connecting=!1,e.emit("disconnected")},this.socket.onmessage=function(t){var n=(0,b.decodeBrowserWrapper)(t.data);e.emit(n.type,(0,b.decodeMessage)(n.type,n.msg),n.subId)})}},{key:"disconnect",value:function(){void 0!==this.socket&&(this.connected||this.connecting)&&(this.disconnecting=!0,this.socket.close())}},{key:"send",value:function(e){this.socket.send(JSON.stringify(e))}}]),t}(a.default);t.default=p,e.exports=t.default}])});